<!doctype html>
<html xml:lang="en-gb" lang="en-gb" >
    <head>
        <title>Ramblers Places</title>
        <!--- Leaflet -->
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <!-- Ramblers -->
        <link rel="stylesheet" href="dist/ramblerplaces.css" />
        <script src="dist/ramblersplaces.js" ></script>
        <!--- Google maps -->
        <script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
        <script src="dist/Google.js"></script>
        <!--- Clustering -->
        <link rel="stylesheet" href="dist/MarkerCluster.css" />
        <link rel="stylesheet" href="dist/MarkerCluster.Default.css" />
        <link rel="stylesheet" href="dist/screen.css" />
        <script src="dist/leaflet.markercluster-src.js"></script>
        <!--- Search -->
        <script src="dist/l.control.geosearch.js"></script>
        <script src="dist/l.geosearch.provider.openstreetmap.js"></script>
        <link rel="stylesheet" href="dist/l.geosearch.css" />
    </head>
    <body class="fullbody">
        <div id="progress"><div id="progress-bar"></div></div> 
        <div id="map-container" style="float:left,height:auto">
            <div id="map"></div>
        </div>
        <div class="topmenu">
            // [[Insert menu]] 
        </div>
        <div class="footer" >
            <span id="agreed">You have agreed that you will check the suitability of locations before you use them.</span>
        </div>
        <script>
            var map = new L.Map('map', {center: new L.LatLng(54.221592, -3.355007),
                zoom: 5,
                trackResize: true});
            var osm = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> '});
            var osm2 = new L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery Ã‚Â© <a href="http://mapbox.com">Mapbox</a>',
                id: 'examples.map-i875mjb7'});
            L.control.scale().addTo(map);
            var ggl = new L.Google('ROADMAP');
            var ggl2 = new L.Google('HYBRID');
            var ggl3 = new L.Google('SATELLITE');
            map.addLayer(osm);
            new L.Control.GeoSearch({
                provider: new L.GeoSearch.Provider.OpenStreetMap(),
                position: 'topright',
                showMarker: false
            }).addTo(map);
            mapLayers = {'Open Street Map': osm, 'Google': ggl, 'Google Satellite': ggl3, 'Google Hybrid': ggl2};
            var progress = document.getElementById('progress');
            var progressBar = document.getElementById('progress-bar');

            function updateProgressBar(processed, total, elapsed, layersArray) {
                if (elapsed > 1000) {
                    // if it takes more than a second to load, display the progress bar:
                    progress.style.display = 'block';
                    progressBar.style.width = Math.round(processed / total * 100) + '%';
                }

                if (processed === total) {
                    // all markers processed - hide the progress bar:
                    progress.style.display = 'none';
                }
            }
            var s0 = L.icon({
                iconUrl: 'images/rejected.png',
                iconSize: [20, 20]
            });
            var s1 = L.icon({
                iconUrl: 'images/1star.png',
                iconSize: [20, 20]
            });
            var s2 = L.icon({
                iconUrl: 'images/2star.png',
                iconSize: [24, 24]
            });
            var s3 = L.icon({
                iconUrl: 'images/3star.png',
                iconSize: [28, 28]
            });
            var s4 = L.icon({
                iconUrl: 'images/4star.png',
                iconSize: [32, 32]
            });
            var s5 = L.icon({
                iconUrl: 'images/5star.png',
                iconSize: [36, 36]
            });

            var markersCG = L.markerClusterGroup({chunkedLoading: true, chunkProgress: updateProgressBar, disableClusteringAtZoom: 12});

            var mLst = [];
            function makeGroup(color) {
                return new L.MarkerClusterGroup({
                    iconCreateFunction: function (cluster) {
                        return new L.DivIcon({
                            iconSize: [20, 20],
                            html: '<div style="text-align:center;color:#fff;background:' +
                                    color + '">' + cluster.getChildCount() + '</div>'
                        });
                    }
                }).addTo(map);
            }

            // [[Add markers here]]

            markersCG.addLayers(mLst);
            map.addLayer(markersCG);


            map.addControl(new L.Control.Layers(mapLayers));

        </script>


        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="modalclose">x</span>

                <div id="placeinfo"><p>Dummy text</p></div>
            </div>

        </div>
        <script>
// Get the modal
            var modal = document.getElementById('myModal');

// Get the <span> element that closes the modal
            var span = document.getElementsByClassName("modalclose")[0];

// When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }

// When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>
    </body>
</html>